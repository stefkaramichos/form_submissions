<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Signup Form with Signature</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Make the signature canvas look nice & responsive */
    .sig-wrapper {
      border: 1px solid #ced4da;
      border-radius: .375rem;
      position: relative;
      background: #fff;
    }
    .sig-canvas {
      width: 100%;
      height: 200px;
      display: block;
    }
    .sig-actions {
      position: absolute;
      right: .5rem;
      bottom: .5rem;
      display: flex;
      gap: .5rem;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-body">
            <h1 class="h3 mb-3">Registration Form</h1>
            <form id="mainForm" class="needs-validation" action="save_signature.php" method="post" novalidate>
              <!-- Row: First / Last -->
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="firstName" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="firstName" name="first_name" required>
                  <div class="invalid-feedback">Please enter your first name.</div>
                </div>
                <div class="col-md-6">
                  <label for="lastName" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="lastName" name="last_name" required>
                  <div class="invalid-feedback">Please enter your last name.</div>
                </div>
              </div>

              <!-- Row: Email / Phone -->
              <div class="row g-3 mt-1">
                <div class="col-md-6">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email" required>
                  <div class="invalid-feedback">Please provide a valid email.</div>
                </div>
                <div class="col-md-6">
                  <label for="phone" class="form-label">Phone</label>
                  <input type="tel" class="form-control" id="phone" name="phone" placeholder="+1 555 123 4567" required>
                  <div class="invalid-feedback">Please provide a phone number.</div>
                </div>
              </div>

              <!-- Select -->
              <div class="mt-3">
                <label for="topic" class="form-label">Topic</label>
                <select class="form-select" id="topic" name="topic" required>
                  <option value="" selected disabled>Choose...</option>
                  <option>General Inquiry</option>
                  <option>Support</option>
                  <option>Billing</option>
                  <option>Partnership</option>
                </select>
                <div class="invalid-feedback">Please choose a topic.</div>
              </div>

              <!-- Radios -->
              <div class="mt-3">
                <label class="form-label d-block">Preferred Contact</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="contact_pref" id="contactEmail" value="Email" required>
                  <label class="form-check-label" for="contactEmail">Email</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="contact_pref" id="contactPhone" value="Phone" required>
                  <label class="form-check-label" for="contactPhone">Phone</label>
                </div>
                <div class="invalid-feedback d-block">Please select a contact preference.</div>
              </div>

              <!-- Checkboxes -->
              <div class="mt-3">
                <label class="form-label d-block">Interests</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="News" id="chkNews" name="interests[]">
                  <label class="form-check-label" for="chkNews">Product news</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Events" id="chkEvents" name="interests[]">
                  <label class="form-check-label" for="chkEvents">Events & webinars</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Offers" id="chkOffers" name="interests[]">
                  <label class="form-check-label" for="chkOffers">Special offers</label>
                </div>
              </div>

              <!-- Message -->
              <div class="mt-3">
                <label for="message" class="form-label">Message</label>
                <textarea class="form-control" id="message" name="message" rows="4"></textarea>
              </div>

              <!-- Signature -->
              <div class="mt-4">
                <label class="form-label">Signature</label>
                <div class="sig-wrapper">
                  <canvas id="signature-pad" class="sig-canvas"></canvas>
                  <div class="sig-actions">
                    <button type="button" id="btnClear" class="btn btn-sm btn-outline-secondary">Clear</button>
                  </div>
                </div>
                <div class="form-text">Please sign in the box above.</div>
                <div id="sigFeedback" class="text-danger small mt-1" style="display:none;">Please add your signature.</div>
                <!-- Hidden input to carry Base64 to PHP -->
                <input type="hidden" id="signatureData" name="signature_data">
              </div>

              <!-- Terms -->
              <div class="form-check mt-4">
                <input class="form-check-input" type="checkbox" value="1" id="terms" name="terms" required>
                <label class="form-check-label" for="terms">
                  I agree to the terms & privacy policy.
                </label>
                <div class="invalid-feedback">You must agree before submitting.</div>
              </div>

              <!-- Submit -->
              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-outline-secondary" type="reset">Reset</button>
              </div>
            </form>

            <div id="submitResult" class="mt-4"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Signature Pad library -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <!-- Bootstrap JS (optional for some components) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Init Signature Pad
    const canvas = document.getElementById('signature-pad');
    const signaturePad = new SignaturePad(canvas, {backgroundColor: 'rgb(255,255,255)'});

    // Resize canvas to device pixel ratio for crisp lines
    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * ratio;
      canvas.height = 200 * ratio; // keep height consistent
      canvas.getContext('2d').scale(ratio, ratio);
      signaturePad.clear();
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Clear button
    document.getElementById('btnClear').addEventListener('click', () => {
      signaturePad.clear();
      document.getElementById('sigFeedback').style.display = 'none';
    });

    // Bootstrap validation + inject signature before submit
    (function () {
      const form = document.getElementById('mainForm');
      form.addEventListener('submit', function (event) {
        // Bootstrap validation
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }

        // Require a signature
        if (signaturePad.isEmpty()) {
          event.preventDefault();
          event.stopPropagation();
          document.getElementById('sigFeedback').style.display = 'block';
        } else {
          // Put Base64 into hidden field
          const dataURL = signaturePad.toDataURL('image/png');
          document.getElementById('signatureData').value = dataURL;
        }

        form.classList.add('was-validated');
      }, false);
    })();
  </script>
</body>
</html>
